# Extensible Health Check System

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ª–µ–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª—é–±—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–∂–Ω–æ—Å—Ç–∏
- **–¢–∞–π–º–∞—É—Ç—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏

## üìã –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **API Endpoint** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API
- **Memory Usage** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–ø–æ—Ä–æ–≥ 80%)
- **File System** - –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- **Environment** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ø—Ä–∏–º–µ—Ä—ã)
- **CPU Usage** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- **Disk Space** - —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- **Network Connectivity** - —Å–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å
- **SSL Certificates** - –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- **Database** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫—ç—à—É
- **External APIs** - –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

## üîß –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

```typescript
import { HealthCheckPlugin, HealthCheckResult } from '@/lib/system-status';

export class MyCustomHealthCheckPlugin implements HealthCheckPlugin {
  name = 'my-service';
  description = 'My custom service health check';
  critical = false; // true = –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  timeout = 3000; // —Ç–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

  async check(): Promise<HealthCheckResult> {
    const startTime = Date.now();
    
    try {
      // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–µ—Å—å
      const isHealthy = await this.performCheck();
      
      const responseTime = Date.now() - startTime;
      
      return {
        healthy: isHealthy,
        responseTime,
        details: {
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          customField: 'value'
        },
        error: isHealthy ? undefined : '–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏'
      };
    } catch (error) {
      const responseTime = Date.now() - startTime;
      return {
        healthy: false,
        responseTime,
        error: error instanceof Error ? error.message : 'Unknown error'
      };
    }
  }

  private async performCheck(): Promise<boolean> {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    return true;
  }
}
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```typescript
import { addHealthCheck } from '@/lib/system-status';
import { MyCustomHealthCheckPlugin } from './my-custom-health-check';

// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
addHealthCheck(new MyCustomHealthCheckPlugin());
```

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```typescript
import { removeHealthCheck } from '@/lib/system-status';

// –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –∏–º–µ–Ω–∏
removeHealthCheck('my-service');
```

## üìä –¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### HTTP Health Check
```typescript
import { HttpHealthCheckPlugin } from '@/lib/system-status';

const httpCheck = new HttpHealthCheckPlugin(
  'external-api',
  'https://api.example.com/health',
  true, // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
  5000, // —Ç–∞–π–º–∞—É—Ç
  'External API health check'
);

addHealthCheck(httpCheck);
```

### External API Check
```typescript
import { ExternalApiHealthCheckPlugin } from '@/lib/health-check-plugins';

const apiCheck = new ExternalApiHealthCheckPlugin(
  'payment-service',
  'https://api.stripe.com/health',
  true, // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
  5000,
  'Stripe payment service check',
  200 // –æ–∂–∏–¥–∞–µ–º—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥
);

addHealthCheck(apiCheck);
```

### Database Check (PostgreSQL)
```typescript
import { PostgresHealthCheckPlugin } from '@/lib/health-check-plugins';

// –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –∫–ª–∞—Å—Å–µ
class MyPostgresCheck extends PostgresHealthCheckPlugin {
  async check(): Promise<HealthCheckResult> {
    const startTime = Date.now();
    
    try {
      // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
      const { Client } = require('pg');
      const client = new Client(process.env.DATABASE_URL);
      await client.connect();
      const result = await client.query('SELECT 1');
      await client.end();
      
      const responseTime = Date.now() - startTime;
      
      return {
        healthy: true,
        responseTime,
        details: {
          connected: true,
          type: 'postgresql'
        }
      };
    } catch (error) {
      const responseTime = Date.now() - startTime;
      return {
        healthy: false,
        responseTime,
        error: error instanceof Error ? error.message : 'Unknown error'
      };
    }
  }
}

addHealthCheck(new MyPostgresCheck());
```

## üéØ –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–û–¥–∏–Ω —Å–±–æ–π** = —Å–∏—Å—Ç–µ–º–∞ **Offline**
- –í–ª–∏—è—é—Ç –Ω–∞ –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–û–¥–∏–Ω —Å–±–æ–π** = —Å–∏—Å—Ç–µ–º–∞ **Degraded**
- **–ù–µ—Å–∫–æ–ª—å–∫–æ —Å–±–æ–µ–≤** = —Å–∏—Å—Ç–µ–º–∞ **Degraded**
- –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –°—Ç–∞—Ç—É—Å—ã —Å–∏—Å—Ç–µ–º—ã
- üü¢ **Online** - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- üü° **Degraded** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ—à–ª–∏
- üî¥ **Offline** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞
- üîµ **Maintenance** - —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ **30 —Å–µ–∫—É–Ω–¥**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∫—ç—à–∞
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `refreshSystemStatus()`

### –¢–∞–π–º–∞—É—Ç—ã
- –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π —Ç–∞–π–º–∞—É—Ç
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **5000ms**
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–±—â–∏–π —Ç–∞–π–º–∞—É—Ç = –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫
```typescript
import { getHealthChecks } from '@/lib/system-status';

const checks = getHealthChecks();
console.log('Registered checks:', checks.map(c => c.name));
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```typescript
import { getSystemStatus } from '@/lib/system-status';

const status = await getSystemStatus();
console.log('System status:', status.status);
console.log('Services:', status.services);
console.log('Message:', status.message);
```

### API Endpoint
```
GET /api/health
```

–û—Ç–≤–µ—Ç:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "uptime": 3600,
  "environment": "production",
  "version": "2.1.4",
  "responseTime": 150,
  "message": "All systems operational (150ms)",
  "services": {
    "api": {
      "status": "healthy",
      "responseTime": 50,
      "lastCheck": 1704110400000,
      "details": {
        "statusCode": 200,
        "statusText": "OK"
      }
    },
    "memory": {
      "status": "healthy",
      "responseTime": 1,
      "lastCheck": 1704110400000,
      "details": {
        "heapUsed": 45,
        "heapTotal": 100,
        "heapUsagePercent": 45,
        "threshold": 80
      }
    }
  }
}
```

## üõ†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# API endpoints
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_HEALTH_URL=http://localhost:3001/health
NEXT_PUBLIC_STATUS_URL=http://localhost:3001/status

# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/db

# Redis
REDIS_URL=redis://localhost:6379
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∫–æ–¥–µ
```typescript
// –í app/layout.tsx –∏–ª–∏ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
import { initializeDefaultHealthChecks } from '@/lib/system-status';

if (typeof window === 'undefined') {
  initializeDefaultHealthChecks();
}
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```typescript
import { ExternalApiHealthCheckPlugin } from '@/lib/health-check-plugins';
import { addHealthCheck } from '@/lib/system-status';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
addHealthCheck(new ExternalApiHealthCheckPlugin(
  'stripe',
  'https://api.stripe.com/health',
  true, // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
  5000,
  'Stripe payment service'
));

// –ü—Ä–æ–≤–µ—Ä–∫–∞ email —Å–µ—Ä–≤–∏—Å–∞
addHealthCheck(new ExternalApiHealthCheckPlugin(
  'sendgrid',
  'https://api.sendgrid.com/health',
  false, // –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
  3000,
  'SendGrid email service'
));
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
```typescript
import { 
  CpuHealthCheckPlugin,
  DiskSpaceHealthCheckPlugin,
  NetworkHealthCheckPlugin 
} from '@/lib/health-check-plugins';

addHealthCheck(new CpuHealthCheckPlugin());
addHealthCheck(new DiskSpaceHealthCheckPlugin());
addHealthCheck(new NetworkHealthCheckPlugin());
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```typescript
import { 
  addHealthCheck, 
  removeHealthCheck, 
  getHealthChecks 
} from '@/lib/system-status';

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
const checks = getHealthChecks();
console.log('Active checks:', checks.map(c => c.name));

// –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
removeHealthCheck('cpu');

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
addHealthCheck(new MyCustomCheck());
```

## üö® Troubleshooting

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫

### –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫
2. –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã
3. –î–æ–±–∞–≤—å—Ç–µ retry –ª–æ–≥–∏–∫—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
1. –£–º–µ–Ω—å—à–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –ø—Ä–æ–≤–µ—Ä–æ–∫
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–æ–∫
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ü—Ä–∏–º–µ—Ä—ã –ø–ª–∞–≥–∏–Ω–æ–≤](./lib/health-check-plugins.ts)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](./lib/health-check-examples.ts)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](./lib/system-status.ts)
- [Health endpoint](./app/api/health/route.ts) 